
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../sensitivity_analyzer/">
      
      
        <link rel="next" href="../data_manager/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.23">
    
    
      
        <title>Calibration - pySWATPlus</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pySWATPlus.Calibration" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="pySWATPlus" class="md-header__button md-logo" aria-label="pySWATPlus" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            pySWATPlus
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Calibration
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../userguide/swatplus_simulation/" class="md-tabs__link">
          
  
  
  User Guide

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../txtinout_reader/" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../CONTRIBUTING/" class="md-tabs__link">
        
  
  
    
  
  Contributor Guide

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../changelog/" class="md-tabs__link">
        
  
  
    
  
  Release Notes

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="pySWATPlus" class="md-nav__button md-logo" aria-label="pySWATPlus" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    pySWATPlus
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/swatplus_simulation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SWAT+ Simulation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/sensitivity_interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sensitivity Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/model_calibration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Model Calibration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/data_analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../txtinout_reader/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TxtinoutReader
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../performance_metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PerformanceMetrics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sensitivity_analyzer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SensitivityAnalyzer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Calibration
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Calibration
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pySWATPlus.Calibration" class="md-nav__link">
    <span class="md-ellipsis">
      Calibration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Calibration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pySWATPlus.Calibration.parameter_optimization" class="md-nav__link">
    <span class="md-ellipsis">
      parameter_optimization
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data_manager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DataManager
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CONTRIBUTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributor Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release Notes
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pySWATPlus.Calibration" class="md-nav__link">
    <span class="md-ellipsis">
      Calibration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Calibration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pySWATPlus.Calibration.parameter_optimization" class="md-nav__link">
    <span class="md-ellipsis">
      parameter_optimization
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Calibration</h1>

<div class="doc doc-object doc-class">



<h2 id="pySWATPlus.Calibration" class="doc doc-heading">
            <code>Calibration</code>


</h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pymoo.core.problem.Problem">Problem</span></code></p>



        <p>A <code>Problem</code> subclass from the <a href="https://github.com/anyoptimization/pymoo"><code>pymoo</code></a> Python package
for performing model calibration against observed data using multi-objective optimization
and evolutionary algorithms.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>parameters</code>
            </td>
            <td>
                  <code><span title="pySWATPlus.newtype.BoundType">BoundType</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of dictionaries defining parameter configurations for calibration simulations.
Each dictionary contain the following keys:</p>
<ul>
<li><code>name</code> (str): <strong>Required.</strong> Name of the parameter in the <code>cal_parms.cal</code> file.</li>
<li><code>change_type</code> (str): <strong>Required.</strong> Type of change to apply. Must be one of 'absval', 'abschg', or 'pctchg'.</li>
<li><code>lower_bound</code> (float): <strong>Required.</strong> Lower bound for the parameter.</li>
<li><code>upper_bound</code> (float): <strong>Required.</strong> Upper bound for the parameter.</li>
<li><code>units</code> (Iterable[int]): Optional. List of unit IDs to which the parameter change should be constrained.</li>
<li><code>conditions</code> (dict[str, list[str]]): Optional.  Conditions to apply when changing the parameter.
  Supported keys include <code>'hsg'</code>, <code>'texture'</code>, <code>'plant'</code>, and <code>'landuse'</code>, each mapped to a list of allowed values.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;cn2&#39;</span><span class="p">,</span>
        <span class="s1">&#39;change_type&#39;</span><span class="p">:</span> <span class="s1">&#39;pctchg&#39;</span><span class="p">,</span>
        <span class="s1">&#39;lower_bound&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
        <span class="s1">&#39;upper_bound&#39;</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;perco&#39;</span><span class="p">,</span>
        <span class="s1">&#39;change_type&#39;</span><span class="p">:</span> <span class="s1">&#39;absval&#39;</span><span class="p">,</span>
        <span class="s1">&#39;lower_bound&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;upper_bound&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;conditions&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;hsg&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;bf_max&#39;</span><span class="p">,</span>
        <span class="s1">&#39;change_type&#39;</span><span class="p">:</span> <span class="s1">&#39;absval&#39;</span><span class="p">,</span>
        <span class="s1">&#39;lower_bound&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="s1">&#39;upper_bound&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
        <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">194</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">]</span>
</code></pre></div>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>calsim_dir</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the directory where simulations for each individual in each generation will be performed.
Raises an error if the folder is not empty. This precaution helps prevent data deletion, overwriting directories,
and issues with reading required data files not generated by the simulation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>txtinout_dir</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the <code>TxtInOut</code> directory containing the required files for SWAT+ simulation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>extract_data</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A nested dictionary specifying how to extract data from SWAT+ simulation output files.
The top-level keys are filenames of the output files, without paths (e.g., <code>channel_sd_day.txt</code>). Each key must map to a non-empty dictionary
containing the following sub-keys, which correspond to the input variables within the method
<a href="https://swat-model.github.io/pySWATPlus/api/data_manager/#pySWATPlus.DataManager.simulated_timeseries_df"><code>simulated_timeseries_df</code></a>:</p>
<ul>
<li><code>has_units</code> (bool): <strong>Required.</strong> If <code>True</code>, the third line of the simulated file contains units for the columns.</li>
<li><code>begin_date</code> (str): Optional. Start date in <code>DD-Mon-YYYY</code> format (e.g., 01-Jan-2010). Defaults to the earliest date in the simulated file.</li>
<li><code>end_date</code> (str): Optional. End date in <code>DD-Mon-YYYY</code> format (e.g., 31-Dec-2013). Defaults to the latest date in the simulated file.</li>
<li><code>ref_day</code> (int): Optional. Reference day for monthly and yearly time series.
   If <code>None</code> (default), the last day of the month or year is used, obtained from simulation. Not applicable to daily time series files (ending with <code>_day</code>).</li>
<li><code>ref_month</code> (int): Optional. Reference month for yearly time series. If <code>None</code> (default), the last month of the year is used, obtained from simulation.
  Not applicable to monthly time series files (ending with <code>_mon</code>).</li>
<li><code>apply_filter</code> (dict[str, list[typing.Any]]): Optional. Each key is a column name and the corresponding value
  is a list of allowed values for filtering rows in the DataFrame. By default, no filtering is applied.
  An error is raised if filtering produces an empty DataFrame.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The sub-key <code>usecols</code> should <strong>not</strong> be included here. Although no error will be raised, it will be ignored during class initialization
because the <code>sim_col</code> sub-key from the <code>objective_config</code> input is automatically used as <code>usecols</code>. Including it manually has no effect.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="n">extract_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;channel_sd_day.txt&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;has_units&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;begin_date&#39;</span><span class="p">:</span> <span class="s1">&#39;01-Jun-2014&#39;</span><span class="p">,</span>
        <span class="s1">&#39;end_date&#39;</span><span class="p">:</span> <span class="s1">&#39;01-Oct-2016&#39;</span><span class="p">,</span>
        <span class="s1">&#39;apply_filter&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;gis_id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">561</span><span class="p">]}</span>
    <span class="p">},</span>
    <span class="s1">&#39;channel_sd_mon.txt&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;has_units&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;apply_filter&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;cha561&#39;</span><span class="p">]}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>observe_data</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A nested dictionary specifying observed data configuration. The top-level keys
are same as keys of <code>extract_data</code> (e.g., <code>channel_sd_day.txt</code>). Each key must map to a non-empty dictionary containing the following sub-keys:</p>
<ul>
<li><code>obs_file</code> (str): <strong>Required.</strong> Path to the CSV file containing observed data. The file must include a <code>date</code> column with comma as the
  separator to read the <code>DataFrame</code> by the <a href="https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html#pandas-read-csv"><code>pandas.read_csv</code></a>
  method. The <code>date</code> col will be used to merge simulated and observed data.</li>
<li><code>date_format</code> (str): <strong>Required.</strong> Date format of the <code>date</code> column in <code>obs_file</code>, used to parse <code>datetime.date</code> objects from date strings.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">observe_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;channel_sd_day.txt&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;obs_file&#39;</span><span class="p">:</span> <span class="s2">&quot;C:\Users\Username\observed_data\discharge_daily.csv&quot;</span><span class="p">,</span>
        <span class="s1">&#39;date_format&#39;</span><span class="p">:</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span>
    <span class="p">},</span>
    <span class="s1">&#39;channel_sd_mon.txt&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;obs_file&#39;</span><span class="p">:</span> <span class="s2">&quot;C:\Users\Username\observed_data\discharge_monthly.csv&quot;</span><span class="p">,</span>
        <span class="s1">&#39;date_format&#39;</span><span class="p">:</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>objective_config</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A nested dictionary specifying objectives configuration. The top-level keys
are same as keys of <code>extract_data</code> (e.g., <code>channel_sd_day.txt</code>). Each key must map to a non-empty dictionary containing the following sub-keys:</p>
<ul>
<li><code>sim_col</code> (str): <strong>Required.</strong> Name of the column containing simulated values.</li>
<li><code>obs_col</code> (str): <strong>Required.</strong> Name of the column containing observed values.</li>
<li>
<p><code>indicator</code> (str): <strong>Required.</strong> Name of the performance indicator used for optimization.
  Available options with their optimization direction are listed below:</p>
<ul>
<li><code>NSE</code>: Nash–Sutcliffe Efficiency (<strong>maximize</strong>).</li>
<li><code>KGE</code>: Kling–Gupta Efficiency (<strong>maximize</strong>).</li>
<li><code>MSE</code>: Mean Squared Error (<strong>minimize</strong>).</li>
<li><code>RMSE</code>: Root Mean Squared Error (<strong>minimize</strong>).</li>
<li><code>MARE</code>: Mean Absolute Relative Error (<strong>minimize</strong>).</li>
</ul>
</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Avoid using <code>MARE</code> if <code>obs_col</code> contains zero values, as it will cause a division-by-zero error.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="n">objective_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;channel_sd_day.txt&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;sim_col&#39;</span><span class="p">:</span> <span class="s1">&#39;flo_out&#39;</span><span class="p">,</span>
        <span class="s1">&#39;obs_col&#39;</span><span class="p">:</span> <span class="s1">&#39;discharge&#39;</span><span class="p">,</span>
        <span class="s1">&#39;indicator&#39;</span><span class="p">:</span> <span class="s1">&#39;NSE&#39;</span>
    <span class="p">},</span>
    <span class="s1">&#39;channel_sd_mon.txt&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;sim_col&#39;</span><span class="p">:</span> <span class="s1">&#39;flo_out&#39;</span><span class="p">,</span>
        <span class="s1">&#39;obs_col&#39;</span><span class="p">:</span> <span class="s1">&#39;discharge&#39;</span><span class="p">,</span>
        <span class="s1">&#39;indicator&#39;</span><span class="p">:</span> <span class="s1">&#39;MSE&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>algorithm</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the alogrithm. Available options:</p>
<ul>
<li><code>GA</code>: Genetic Algorithm (<strong>single-objective</strong>).</li>
<li><code>DE</code>: <a href="https://doi.org/10.1007/3-540-31306-0">Differential Evolution Algorithm</a> (<strong>single-objective</strong>).</li>
<li><code>NSGA2</code>: <a href="https://doi.org/10.1109/4235.996017">Non-dominated sorted Genetic Algorithm - II</a> (<strong>multi-objective</strong>).</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Multi-objective algorithms can be used for single-objective optimization, but not vice versa.</p>
</div>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_gen</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of generation that alogirithm will run.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pop_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of individual in each generation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_workers</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of logical CPUs to use for parallel processing. If <code>None</code> (default), all available logical CPUs are used.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Simulation efficiency can be improved by choosing <code>pop_size</code> strategically.
The total number of simulations during optimization equals <code>n_gen × pop_size</code>.
Simulations within a generation are executed in parallel batches depending on CPU availability.
For example, with 16 CPUs and a <code>pop_size</code> of 20, two batches will be required (16 + 4);
therefore, selecting a <code>pop_size</code> of 16 or 32 may improve efficiency.</p>
</div>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>pySWATPlus/calibration.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Calibration</span><span class="p">(</span><span class="n">pymoo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">Problem</span><span class="p">):</span>  <span class="c1"># type: ignore[misc]</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A `Problem` subclass from the [`pymoo`](https://github.com/anyoptimization/pymoo) Python package</span>
<span class="sd">    for performing model calibration against observed data using multi-objective optimization</span>
<span class="sd">    and evolutionary algorithms.</span>

<span class="sd">    Args:</span>
<span class="sd">        parameters (newtype.BoundType): List of dictionaries defining parameter configurations for calibration simulations.</span>
<span class="sd">            Each dictionary contain the following keys:</span>

<span class="sd">            - `name` (str): **Required.** Name of the parameter in the `cal_parms.cal` file.</span>
<span class="sd">            - `change_type` (str): **Required.** Type of change to apply. Must be one of &#39;absval&#39;, &#39;abschg&#39;, or &#39;pctchg&#39;.</span>
<span class="sd">            - `lower_bound` (float): **Required.** Lower bound for the parameter.</span>
<span class="sd">            - `upper_bound` (float): **Required.** Upper bound for the parameter.</span>
<span class="sd">            - `units` (Iterable[int]): Optional. List of unit IDs to which the parameter change should be constrained.</span>
<span class="sd">            - `conditions` (dict[str, list[str]]): Optional.  Conditions to apply when changing the parameter.</span>
<span class="sd">              Supported keys include `&#39;hsg&#39;`, `&#39;texture&#39;`, `&#39;plant&#39;`, and `&#39;landuse&#39;`, each mapped to a list of allowed values.</span>

<span class="sd">            ```python</span>
<span class="sd">            parameters = [</span>
<span class="sd">                {</span>
<span class="sd">                    &#39;name&#39;: &#39;cn2&#39;,</span>
<span class="sd">                    &#39;change_type&#39;: &#39;pctchg&#39;,</span>
<span class="sd">                    &#39;lower_bound&#39;: 25,</span>
<span class="sd">                    &#39;upper_bound&#39;: 75,</span>
<span class="sd">                },</span>
<span class="sd">                {</span>
<span class="sd">                    &#39;name&#39;: &#39;perco&#39;,</span>
<span class="sd">                    &#39;change_type&#39;: &#39;absval&#39;,</span>
<span class="sd">                    &#39;lower_bound&#39;: 0,</span>
<span class="sd">                    &#39;upper_bound&#39;: 1,</span>
<span class="sd">                    &#39;conditions&#39;: {&#39;hsg&#39;: [&#39;A&#39;]}</span>
<span class="sd">                },</span>
<span class="sd">                {</span>
<span class="sd">                    &#39;name&#39;: &#39;bf_max&#39;,</span>
<span class="sd">                    &#39;change_type&#39;: &#39;absval&#39;,</span>
<span class="sd">                    &#39;lower_bound&#39;: 0.1,</span>
<span class="sd">                    &#39;upper_bound&#39;: 2.0,</span>
<span class="sd">                    &#39;units&#39;: range(1, 194)</span>
<span class="sd">                }</span>
<span class="sd">            ]</span>
<span class="sd">            ```</span>

<span class="sd">        calsim_dir (str | pathlib.Path): Path to the directory where simulations for each individual in each generation will be performed.</span>
<span class="sd">            Raises an error if the folder is not empty. This precaution helps prevent data deletion, overwriting directories,</span>
<span class="sd">            and issues with reading required data files not generated by the simulation.</span>

<span class="sd">        txtinout_dir (str | pathlib.Path): Path to the `TxtInOut` directory containing the required files for SWAT+ simulation.</span>

<span class="sd">        extract_data (dict[str, dict[str, typing.Any]]): A nested dictionary specifying how to extract data from SWAT+ simulation output files.</span>
<span class="sd">            The top-level keys are filenames of the output files, without paths (e.g., `channel_sd_day.txt`). Each key must map to a non-empty dictionary</span>
<span class="sd">            containing the following sub-keys, which correspond to the input variables within the method</span>
<span class="sd">            [`simulated_timeseries_df`](https://swat-model.github.io/pySWATPlus/api/data_manager/#pySWATPlus.DataManager.simulated_timeseries_df):</span>

<span class="sd">            - `has_units` (bool): **Required.** If `True`, the third line of the simulated file contains units for the columns.</span>
<span class="sd">            - `begin_date` (str): Optional. Start date in `DD-Mon-YYYY` format (e.g., 01-Jan-2010). Defaults to the earliest date in the simulated file.</span>
<span class="sd">            - `end_date` (str): Optional. End date in `DD-Mon-YYYY` format (e.g., 31-Dec-2013). Defaults to the latest date in the simulated file.</span>
<span class="sd">            - `ref_day` (int): Optional. Reference day for monthly and yearly time series.</span>
<span class="sd">               If `None` (default), the last day of the month or year is used, obtained from simulation. Not applicable to daily time series files (ending with `_day`).</span>
<span class="sd">            - `ref_month` (int): Optional. Reference month for yearly time series. If `None` (default), the last month of the year is used, obtained from simulation.</span>
<span class="sd">              Not applicable to monthly time series files (ending with `_mon`).</span>
<span class="sd">            - `apply_filter` (dict[str, list[typing.Any]]): Optional. Each key is a column name and the corresponding value</span>
<span class="sd">              is a list of allowed values for filtering rows in the DataFrame. By default, no filtering is applied.</span>
<span class="sd">              An error is raised if filtering produces an empty DataFrame.</span>

<span class="sd">            !!! note</span>
<span class="sd">                The sub-key `usecols` should **not** be included here. Although no error will be raised, it will be ignored during class initialization</span>
<span class="sd">                because the `sim_col` sub-key from the `objective_config` input is automatically used as `usecols`. Including it manually has no effect.</span>

<span class="sd">            ```python</span>
<span class="sd">            extract_data = {</span>
<span class="sd">                &#39;channel_sd_day.txt&#39;: {</span>
<span class="sd">                    &#39;has_units&#39;: True,</span>
<span class="sd">                    &#39;begin_date&#39;: &#39;01-Jun-2014&#39;,</span>
<span class="sd">                    &#39;end_date&#39;: &#39;01-Oct-2016&#39;,</span>
<span class="sd">                    &#39;apply_filter&#39;: {&#39;gis_id&#39;: [561]}</span>
<span class="sd">                },</span>
<span class="sd">                &#39;channel_sd_mon.txt&#39;: {</span>
<span class="sd">                    &#39;has_units&#39;: True,</span>
<span class="sd">                    &#39;apply_filter&#39;: {&#39;name&#39;: [&#39;cha561&#39;]}</span>
<span class="sd">                }</span>
<span class="sd">            }</span>
<span class="sd">            ```</span>

<span class="sd">        observe_data (dict[str, dict[str, str]]): A nested dictionary specifying observed data configuration. The top-level keys</span>
<span class="sd">            are same as keys of `extract_data` (e.g., `channel_sd_day.txt`). Each key must map to a non-empty dictionary containing the following sub-keys:</span>

<span class="sd">            - `obs_file` (str): **Required.** Path to the CSV file containing observed data. The file must include a `date` column with comma as the</span>
<span class="sd">              separator to read the `DataFrame` by the [`pandas.read_csv`](https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html#pandas-read-csv)</span>
<span class="sd">              method. The `date` col will be used to merge simulated and observed data.</span>
<span class="sd">            - `date_format` (str): **Required.** Date format of the `date` column in `obs_file`, used to parse `datetime.date` objects from date strings.</span>

<span class="sd">            ```python</span>
<span class="sd">            observe_data = {</span>
<span class="sd">                &#39;channel_sd_day.txt&#39;: {</span>
<span class="sd">                    &#39;obs_file&#39;: &quot;C:\\Users\\Username\\observed_data\\discharge_daily.csv&quot;,</span>
<span class="sd">                    &#39;date_format&#39;: &#39;%Y-%m-%d&#39;</span>
<span class="sd">                },</span>
<span class="sd">                &#39;channel_sd_mon.txt&#39;: {</span>
<span class="sd">                    &#39;obs_file&#39;: &quot;C:\\Users\\Username\\observed_data\\discharge_monthly.csv&quot;,</span>
<span class="sd">                    &#39;date_format&#39;: &#39;%Y-%m-%d&#39;</span>
<span class="sd">                }</span>
<span class="sd">            }</span>
<span class="sd">            ```</span>

<span class="sd">        objective_config (dict[str, dict[str, str]]): A nested dictionary specifying objectives configuration. The top-level keys</span>
<span class="sd">            are same as keys of `extract_data` (e.g., `channel_sd_day.txt`). Each key must map to a non-empty dictionary containing the following sub-keys:</span>

<span class="sd">            - `sim_col` (str): **Required.** Name of the column containing simulated values.</span>
<span class="sd">            - `obs_col` (str): **Required.** Name of the column containing observed values.</span>
<span class="sd">            - `indicator` (str): **Required.** Name of the performance indicator used for optimization.</span>
<span class="sd">              Available options with their optimization direction are listed below:</span>

<span class="sd">                - `NSE`: Nash–Sutcliffe Efficiency (**maximize**).</span>
<span class="sd">                - `KGE`: Kling–Gupta Efficiency (**maximize**).</span>
<span class="sd">                - `MSE`: Mean Squared Error (**minimize**).</span>
<span class="sd">                - `RMSE`: Root Mean Squared Error (**minimize**).</span>
<span class="sd">                - `MARE`: Mean Absolute Relative Error (**minimize**).</span>

<span class="sd">            !!! tip</span>
<span class="sd">                Avoid using `MARE` if `obs_col` contains zero values, as it will cause a division-by-zero error.</span>

<span class="sd">            ```python</span>
<span class="sd">            objective_config = {</span>
<span class="sd">                &#39;channel_sd_day.txt&#39;: {</span>
<span class="sd">                    &#39;sim_col&#39;: &#39;flo_out&#39;,</span>
<span class="sd">                    &#39;obs_col&#39;: &#39;discharge&#39;,</span>
<span class="sd">                    &#39;indicator&#39;: &#39;NSE&#39;</span>
<span class="sd">                },</span>
<span class="sd">                &#39;channel_sd_mon.txt&#39;: {</span>
<span class="sd">                    &#39;sim_col&#39;: &#39;flo_out&#39;,</span>
<span class="sd">                    &#39;obs_col&#39;: &#39;discharge&#39;,</span>
<span class="sd">                    &#39;indicator&#39;: &#39;MSE&#39;</span>
<span class="sd">                }</span>
<span class="sd">            }</span>
<span class="sd">            ```</span>

<span class="sd">        algorithm (str): Name of the alogrithm. Available options:</span>

<span class="sd">            - `GA`: Genetic Algorithm (**single-objective**).</span>
<span class="sd">            - `DE`: [Differential Evolution Algorithm](https://doi.org/10.1007/3-540-31306-0) (**single-objective**).</span>
<span class="sd">            - `NSGA2`: [Non-dominated sorted Genetic Algorithm - II](https://doi.org/10.1109/4235.996017) (**multi-objective**).</span>

<span class="sd">            !!! Note</span>
<span class="sd">                Multi-objective algorithms can be used for single-objective optimization, but not vice versa.</span>

<span class="sd">        n_gen (int): Number of generation that alogirithm will run.</span>

<span class="sd">        pop_size (int): Number of individual in each generation.</span>

<span class="sd">        max_workers (int): Number of logical CPUs to use for parallel processing. If `None` (default), all available logical CPUs are used.</span>

<span class="sd">            !!! tip</span>
<span class="sd">                Simulation efficiency can be improved by choosing `pop_size` strategically.</span>
<span class="sd">                The total number of simulations during optimization equals `n_gen × pop_size`.</span>
<span class="sd">                Simulations within a generation are executed in parallel batches depending on CPU availability.</span>
<span class="sd">                For example, with 16 CPUs and a `pop_size` of 20, two batches will be required (16 + 4);</span>
<span class="sd">                therefore, selecting a `pop_size` of 16 or 32 may improve efficiency.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">:</span> <span class="n">newtype</span><span class="o">.</span><span class="n">BoundType</span><span class="p">,</span>
        <span class="n">calsim_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
        <span class="n">txtinout_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
        <span class="n">extract_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]],</span>
        <span class="n">observe_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
        <span class="n">objective_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
        <span class="n">algorithm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">n_gen</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">pop_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">max_workers</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="c1"># Check input variables type</span>
        <span class="n">validators</span><span class="o">.</span><span class="n">_variable_origin_static_type</span><span class="p">(</span>
            <span class="n">vars_types</span><span class="o">=</span><span class="n">typing</span><span class="o">.</span><span class="n">get_type_hints</span><span class="p">(</span>
                <span class="n">obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="fm">__init__</span>
            <span class="p">),</span>
            <span class="n">vars_values</span><span class="o">=</span><span class="nb">locals</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="c1"># Absolute directory path</span>
        <span class="n">calsim_dir</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">calsim_dir</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="n">txtinout_dir</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">txtinout_dir</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

        <span class="c1"># Validate same top-level keys in dictionaries</span>
        <span class="n">validators</span><span class="o">.</span><span class="n">_dict_key_equal</span><span class="p">(</span>
            <span class="n">extract_data</span><span class="o">=</span><span class="n">extract_data</span><span class="p">,</span>
            <span class="n">observe_data</span><span class="o">=</span><span class="n">observe_data</span><span class="p">,</span>
            <span class="n">objective_config</span><span class="o">=</span><span class="n">objective_config</span>
        <span class="p">)</span>

        <span class="c1"># Dictionary of metric key name</span>
        <span class="n">df_key</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">obj</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_df&#39;</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objective_config</span>
        <span class="p">}</span>

        <span class="c1"># Validate initialization of TxtinoutReader class</span>
        <span class="n">tmp_reader</span> <span class="o">=</span> <span class="n">TxtinoutReader</span><span class="p">(</span>
            <span class="n">tio_dir</span><span class="o">=</span><span class="n">txtinout_dir</span>
        <span class="p">)</span>

        <span class="c1"># Disable CSV print to save time</span>
        <span class="n">tmp_reader</span><span class="o">.</span><span class="n">disable_csv_print</span><span class="p">()</span>

        <span class="c1"># List of BoundDict objects</span>
        <span class="n">params_bounds</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">_parameters_bound_dict_list</span><span class="p">(</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span>
        <span class="p">)</span>

        <span class="c1"># Validate configuration of simulation parameters</span>
        <span class="n">validators</span><span class="o">.</span><span class="n">_simulation_preliminary_setup</span><span class="p">(</span>
            <span class="n">sim_dir</span><span class="o">=</span><span class="n">calsim_dir</span><span class="p">,</span>
            <span class="n">tio_dir</span><span class="o">=</span><span class="n">txtinout_dir</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">params_bounds</span>
        <span class="p">)</span>

        <span class="c1"># Validate objectives configuration</span>
        <span class="n">validators</span><span class="o">.</span><span class="n">_metric_config</span><span class="p">(</span>
            <span class="n">input_dict</span><span class="o">=</span><span class="n">objective_config</span><span class="p">,</span>
            <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;objective_config&#39;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objective_config</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">objective_config</span><span class="p">[</span><span class="n">obj</span><span class="p">][</span><span class="s1">&#39;indicator&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;PBIAS&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;Indicator &quot;PBIAS&quot; is invalid in objective_config; it lacks a defined optimization direction&#39;</span>
                <span class="p">)</span>

        <span class="c1"># Validate observe_data configuration</span>
        <span class="n">validators</span><span class="o">.</span><span class="n">_observe_data_config</span><span class="p">(</span>
            <span class="n">observe_data</span><span class="o">=</span><span class="n">observe_data</span>
        <span class="p">)</span>

        <span class="c1"># Dictionary of observed DataFrames</span>
        <span class="n">observe_dict</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">_observe_data_dict</span><span class="p">(</span>
            <span class="n">observe_data</span><span class="o">=</span><span class="n">observe_data</span><span class="p">,</span>
            <span class="n">metric_config</span><span class="o">=</span><span class="n">objective_config</span><span class="p">,</span>
            <span class="n">df_key</span><span class="o">=</span><span class="n">df_key</span>
        <span class="p">)</span>

        <span class="c1"># Validate extract_data configuration</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">extract_data</span><span class="p">:</span>
            <span class="n">extract_data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;usecols&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">objective_config</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;sim_col&#39;</span><span class="p">]]</span>
        <span class="n">validators</span><span class="o">.</span><span class="n">_extract_data_config</span><span class="p">(</span>
            <span class="n">extract_data</span><span class="o">=</span><span class="n">extract_data</span>
        <span class="p">)</span>

        <span class="c1"># Change variable name with counter (for multiple occurence only) in BoundType</span>
        <span class="n">var_names</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">_parameters_name_with_counter</span><span class="p">(</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">params_bounds</span>
        <span class="p">)</span>

        <span class="c1"># List of variable lower and upper bounds</span>
        <span class="n">var_lb</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">var_ub</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params_bounds</span><span class="p">:</span>
            <span class="n">var_lb</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">lower_bound</span><span class="p">)</span>
            <span class="n">var_ub</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">upper_bound</span><span class="p">)</span>

        <span class="c1"># Initalize parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params_bounds</span> <span class="o">=</span> <span class="n">params_bounds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extract_data</span> <span class="o">=</span> <span class="n">extract_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objective_config</span> <span class="o">=</span> <span class="n">objective_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_names</span> <span class="o">=</span> <span class="n">var_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_key</span> <span class="o">=</span> <span class="n">df_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observe_dict</span> <span class="o">=</span> <span class="n">observe_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calsim_dir</span> <span class="o">=</span> <span class="n">calsim_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txtinout_dir</span> <span class="o">=</span> <span class="n">txtinout_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">=</span> <span class="n">algorithm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_gen</span> <span class="o">=</span> <span class="n">n_gen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_size</span> <span class="o">=</span> <span class="n">pop_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_sim</span> <span class="o">=</span> <span class="n">n_gen</span> <span class="o">*</span> <span class="n">pop_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_workers</span> <span class="o">=</span> <span class="n">max_workers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">track_gen</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Access properties and methods from Problem class</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">n_var</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">params_bounds</span><span class="p">),</span>
            <span class="n">n_obj</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">objective_config</span><span class="p">),</span>
            <span class="n">xl</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">var_lb</span><span class="p">),</span>
            <span class="n">xu</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">var_ub</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">out</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="c1"># Track starting simulation number for each generation</span>
        <span class="n">start_sim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">track_gen</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop_size</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># Display start of current generation number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">track_gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">track_gen</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Started generation: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">track_gen</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_gen</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="p">)</span>

        <span class="c1"># Simulation in separate CPU</span>
        <span class="n">cpu_sim</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
            <span class="n">cpu</span><span class="o">.</span><span class="n">_simulation_output</span><span class="p">,</span>
            <span class="n">num_sim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">total_sim</span><span class="p">,</span>
            <span class="n">var_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var_names</span><span class="p">,</span>
            <span class="n">sim_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calsim_dir</span><span class="p">,</span>
            <span class="n">tio_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">txtinout_dir</span><span class="p">,</span>
            <span class="n">params_bounds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params_bounds</span><span class="p">,</span>
            <span class="n">extract_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">extract_data</span><span class="p">,</span>
            <span class="n">clean_setup</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="c1"># Assign model simulation in individual computer CPU and collect results</span>
        <span class="n">cpu_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ProcessPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="c1"># Multicore simulation</span>
            <span class="n">futures</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">cpu_sim</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start_sim</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">):</span>
                <span class="c1"># Display end of current simulation for tracking</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Completed simulation: </span><span class="si">{</span><span class="n">start_sim</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">futures</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">future</span><span class="p">)</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_sim</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1"># Collect simulation results</span>
                <span class="n">future_result</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
                <span class="n">cpu_dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">future_result</span><span class="p">[</span><span class="s1">&#39;array&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">future_result</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;array&#39;</span>
                <span class="p">}</span>

        <span class="c1"># Mapping betten objectives and their directions</span>
        <span class="n">objs_dirs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objectives_directions</span><span class="p">()</span>

        <span class="c1"># An empty list to store population objectives in current generation</span>
        <span class="n">gen_objs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Iterate population array in the current generation</span>
        <span class="k">for</span> <span class="n">pop</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
            <span class="c1"># Empty list to collect individual population objectives</span>
            <span class="n">pop_objs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># Simulation output for the population</span>
            <span class="n">pop_sim</span> <span class="o">=</span> <span class="n">cpu_dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">pop</span><span class="p">)]</span>
            <span class="c1"># Iterate objectives</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objective_config</span><span class="p">:</span>
                <span class="c1"># Simulated DataFrame</span>
                <span class="n">sim_df</span> <span class="o">=</span> <span class="n">pop_sim</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df_key</span><span class="p">[</span><span class="n">obj</span><span class="p">]]</span>
                <span class="n">sim_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;sim&#39;</span><span class="p">]</span>
                <span class="c1"># Observed DataFrame</span>
                <span class="n">obs_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">observe_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df_key</span><span class="p">[</span><span class="n">obj</span><span class="p">]]</span>
                <span class="c1"># Merge simulated and observed DataFrames by &#39;date&#39; column</span>
                <span class="n">merge_df</span> <span class="o">=</span> <span class="n">sim_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                    <span class="n">right</span><span class="o">=</span><span class="n">obs_df</span><span class="p">,</span>
                    <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span>
                    <span class="n">on</span><span class="o">=</span><span class="s1">&#39;date&#39;</span>
                <span class="p">)</span>
                <span class="c1"># Normalized DataFrame</span>
                <span class="n">norm_df</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">_df_normalize</span><span class="p">(</span>
                    <span class="n">df</span><span class="o">=</span><span class="n">merge_df</span><span class="p">[[</span><span class="s1">&#39;sim&#39;</span><span class="p">,</span> <span class="s1">&#39;obs&#39;</span><span class="p">]],</span>
                    <span class="n">norm_col</span><span class="o">=</span><span class="s1">&#39;obs&#39;</span>
                <span class="p">)</span>
                <span class="c1"># Indicator abbreviation</span>
                <span class="n">obj_ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objective_config</span><span class="p">[</span><span class="n">obj</span><span class="p">][</span><span class="s1">&#39;indicator&#39;</span><span class="p">]</span>
                <span class="c1"># Indicator value</span>
                <span class="n">ind_val</span> <span class="o">=</span> <span class="n">PerformanceMetrics</span><span class="p">()</span><span class="o">.</span><span class="n">compute_from_abbr</span><span class="p">(</span>
                    <span class="n">df</span><span class="o">=</span><span class="n">norm_df</span><span class="p">,</span>
                    <span class="n">sim_col</span><span class="o">=</span><span class="s1">&#39;sim&#39;</span><span class="p">,</span>
                    <span class="n">obs_col</span><span class="o">=</span><span class="s1">&#39;obs&#39;</span><span class="p">,</span>
                    <span class="n">indicator</span><span class="o">=</span><span class="n">obj_ind</span>
                <span class="p">)</span>
                <span class="c1"># Objective value based on maximize or minimize direction</span>
                <span class="n">obj_val</span> <span class="o">=</span> <span class="o">-</span> <span class="n">ind_val</span> <span class="k">if</span> <span class="n">objs_dirs</span><span class="p">[</span><span class="n">obj_ind</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span> <span class="k">else</span> <span class="n">ind_val</span>
                <span class="c1"># Store objective value for sample</span>
                <span class="n">pop_objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj_val</span><span class="p">)</span>
            <span class="c1"># Store sample objectives in population objective list</span>
            <span class="n">gen_objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pop_objs</span><span class="p">)</span>

        <span class="c1"># Array of objective values for the current generation</span>
        <span class="n">out</span><span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gen_objs</span><span class="p">)</span>

        <span class="c1"># Print end of current generation number</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Completed generation: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">track_gen</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_gen</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_objectives_directions</span><span class="p">(</span>
        <span class="bp">self</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Provide a dictionary mapping optimization objectives to their respective directions.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">objs_dirs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;NSE&#39;</span><span class="p">:</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span>
            <span class="s1">&#39;KGE&#39;</span><span class="p">:</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span>
            <span class="s1">&#39;MSE&#39;</span><span class="p">:</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span>
            <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span>
            <span class="s1">&#39;MARE&#39;</span><span class="p">:</span> <span class="s1">&#39;min&#39;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">objs_dirs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_algorithm_class</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">algorithm</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">type</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Retrieve the optimization algorithm class from the `pymoo` package.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">single_obj</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GA&#39;</span><span class="p">,</span> <span class="s1">&#39;DE&#39;</span><span class="p">]</span>
        <span class="n">multi_obj</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NSGA2&#39;</span><span class="p">]</span>

        <span class="c1"># Dictionary mapping between algorithm name and module</span>
        <span class="n">api_module</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;GA&#39;</span><span class="p">:</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s1">&#39;pymoo.algorithms.soo.nonconvex.ga&#39;</span><span class="p">),</span>
            <span class="s1">&#39;DE&#39;</span><span class="p">:</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s1">&#39;pymoo.algorithms.soo.nonconvex.de&#39;</span><span class="p">),</span>
            <span class="s1">&#39;NSGA2&#39;</span><span class="p">:</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s1">&#39;pymoo.algorithms.moo.nsga2&#39;</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1"># Check algorithm name is valid</span>
        <span class="k">if</span> <span class="n">algorithm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">api_module</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Invalid algorithm &quot;</span><span class="si">{</span><span class="n">algorithm</span><span class="si">}</span><span class="s1">&quot;; valid names are </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">api_module</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span>

        <span class="c1"># Check single objective algorithm cannot be used for multiple objectives</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objective_config</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">algorithm</span> <span class="ow">in</span> <span class="n">single_obj</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Algorithm &quot;</span><span class="si">{</span><span class="n">algorithm</span><span class="si">}</span><span class="s1">&quot; cannot handle multiple objectives; use one of </span><span class="si">{</span><span class="n">multi_obj</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span>

        <span class="c1"># Algorithm class</span>
        <span class="n">alg_class</span> <span class="o">=</span> <span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span>
            <span class="nb">type</span><span class="p">,</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">api_module</span><span class="p">[</span><span class="n">algorithm</span><span class="p">],</span> <span class="n">algorithm</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">alg_class</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parameter_optimization</span><span class="p">(</span>
        <span class="bp">self</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Run the optimization using the configured algorithm, population size, and number of generations.</span>

<span class="sd">        This method executes the optimization process and returns a dictionary containing the optimized</span>
<span class="sd">        parameters, corresponding objective values, and total execution time.</span>

<span class="sd">        The following JSON files are saved in `calsim_dir`:</span>

<span class="sd">        - `optimization_history.json`: A dictionary containing the optimization history. Each key in this</span>
<span class="sd">          file is an integer starting from 1, representing the generation number. The corresponding value</span>
<span class="sd">          is a sub-dictionary with two keys: `pop` for the population data (decision variables) and `obj`</span>
<span class="sd">          for the objective function values. This file is useful for analyzing optimization progress,</span>
<span class="sd">          convergence trends, performance indicators, and visualization.</span>

<span class="sd">        - `optimization_result.json`: A dictionary containing the final output dictionary.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary with the following keys:</span>

<span class="sd">                - `algorithm`: Name of the algorithm.</span>
<span class="sd">                - `generation`: Number of generation to run.</span>
<span class="sd">                - `population`: Number of individual in each generation.</span>
<span class="sd">                - `total_simulation`: Number of total simulation.</span>
<span class="sd">                - `time_sec`: Total execution time in seconds.</span>
<span class="sd">                - `variables`: Array of optimized decision variables.</span>
<span class="sd">                - `objectives`: Array of objective values corresponding to the optimized decision variables.</span>

<span class="sd">        Note:</span>
<span class="sd">            - For multi-objective optimization, the number of `variables` and `objectives` may exceed one,</span>
<span class="sd">              representing non-dominated solutions where a solution cannot be improved in one objective</span>
<span class="sd">              without worsening another.</span>

<span class="sd">            - The computation progress can be tracked through the following `console` messages.</span>
<span class="sd">              The simulation index ranges from 1 to the total number of simulations, which equals the product</span>
<span class="sd">              of the population size and the number of generations:</span>

<span class="sd">                - `Started generation: &lt;current_started_generation&gt;/&lt;total_generations&gt;`</span>
<span class="sd">                - `Started simulation: &lt;current_started_index&gt;/&lt;total_simulations&gt;`</span>
<span class="sd">                - `Completed simulation: &lt;current_compeleted_index&gt;/&lt;total_simulations&gt;`</span>
<span class="sd">                - `Completed generation: &lt;current_completed_generation&gt;/&lt;total_generations&gt;`</span>

<span class="sd">            - The disk space on the computer for `calsim_dir` must be sufficient to run</span>
<span class="sd">              parallel simulations (at least `pop_size` times the size of the `TxtInOut` folder).</span>
<span class="sd">              Otherwise, no error will be raised by the system, but simulation outputs may not be generated.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Algorithm object</span>
        <span class="n">alg_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_algorithm_class</span><span class="p">(</span>
            <span class="n">algorithm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span>
        <span class="p">)</span>
        <span class="n">alg_object</span> <span class="o">=</span> <span class="n">alg_class</span><span class="p">(</span>
            <span class="n">pop_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pop_size</span>
        <span class="p">)</span>

        <span class="c1"># Optimization result</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">pymoo</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span>
            <span class="n">problem</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">algorithm</span><span class="o">=</span><span class="n">alg_object</span><span class="p">,</span>
            <span class="n">termination</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;n_gen&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_gen</span><span class="p">),</span>
            <span class="n">save_history</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="c1"># Sign of objective directions</span>
        <span class="n">objs_dirs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objectives_directions</span><span class="p">()</span>
        <span class="n">dir_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">objs_dirs</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;indicator&#39;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objective_config</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">]</span>
        <span class="n">dir_sign</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dir_list</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Save optimization history for each generation</span>
        <span class="n">opt_hist</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">gen</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">history</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">opt_hist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;pop&#39;</span><span class="p">:</span> <span class="n">gen</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="s1">&#39;obj&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">gen</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">dir_sign</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calsim_dir</span> <span class="o">/</span> <span class="s1">&#39;optimization_history.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_write</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">opt_hist</span><span class="p">,</span> <span class="n">output_write</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="c1"># Optimized output of parameters, objectives, and execution times</span>
        <span class="n">opt_output</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;algorithm&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="p">,</span>
            <span class="s1">&#39;generation&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_gen</span><span class="p">,</span>
            <span class="s1">&#39;population&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop_size</span><span class="p">,</span>
            <span class="s1">&#39;total_simulation&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop_size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_gen</span><span class="p">,</span>
            <span class="s1">&#39;time_sec&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exec_time</span><span class="p">),</span>
            <span class="s1">&#39;variables&#39;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">X</span><span class="p">,</span>
            <span class="s1">&#39;objectives&#39;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">F</span> <span class="o">*</span> <span class="n">dir_sign</span>
        <span class="p">}</span>

        <span class="c1"># Save optimized outputs</span>
        <span class="n">save_output</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">opt_output</span><span class="p">)</span>
        <span class="n">save_output</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;var&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">))</span> <span class="k">else</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">save_output</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calsim_dir</span> <span class="o">/</span> <span class="s1">&#39;optimization_result.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_write</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">save_output</span><span class="p">,</span> <span class="n">output_write</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">opt_output</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="pySWATPlus.Calibration.parameter_optimization" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parameter_optimization</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Run the optimization using the configured algorithm, population size, and number of generations.</p>
<p>This method executes the optimization process and returns a dictionary containing the optimized
parameters, corresponding objective values, and total execution time.</p>
<p>The following JSON files are saved in <code>calsim_dir</code>:</p>
<ul>
<li>
<p><code>optimization_history.json</code>: A dictionary containing the optimization history. Each key in this
  file is an integer starting from 1, representing the generation number. The corresponding value
  is a sub-dictionary with two keys: <code>pop</code> for the population data (decision variables) and <code>obj</code>
  for the objective function values. This file is useful for analyzing optimization progress,
  convergence trends, performance indicators, and visualization.</p>
</li>
<li>
<p><code>optimization_result.json</code>: A dictionary containing the final output dictionary.</p>
</li>
</ul>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with the following keys:</p>
<ul>
<li><code>algorithm</code>: Name of the algorithm.</li>
<li><code>generation</code>: Number of generation to run.</li>
<li><code>population</code>: Number of individual in each generation.</li>
<li><code>total_simulation</code>: Number of total simulation.</li>
<li><code>time_sec</code>: Total execution time in seconds.</li>
<li><code>variables</code>: Array of optimized decision variables.</li>
<li><code>objectives</code>: Array of objective values corresponding to the optimized decision variables.</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <ul>
<li>
<p>For multi-objective optimization, the number of <code>variables</code> and <code>objectives</code> may exceed one,
  representing non-dominated solutions where a solution cannot be improved in one objective
  without worsening another.</p>
</li>
<li>
<p>The computation progress can be tracked through the following <code>console</code> messages.
  The simulation index ranges from 1 to the total number of simulations, which equals the product
  of the population size and the number of generations:</p>
<ul>
<li><code>Started generation: &lt;current_started_generation&gt;/&lt;total_generations&gt;</code></li>
<li><code>Started simulation: &lt;current_started_index&gt;/&lt;total_simulations&gt;</code></li>
<li><code>Completed simulation: &lt;current_compeleted_index&gt;/&lt;total_simulations&gt;</code></li>
<li><code>Completed generation: &lt;current_completed_generation&gt;/&lt;total_generations&gt;</code></li>
</ul>
</li>
<li>
<p>The disk space on the computer for <code>calsim_dir</code> must be sufficient to run
  parallel simulations (at least <code>pop_size</code> times the size of the <code>TxtInOut</code> folder).
  Otherwise, no error will be raised by the system, but simulation outputs may not be generated.</p>
</li>
</ul>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>pySWATPlus/calibration.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parameter_optimization</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Run the optimization using the configured algorithm, population size, and number of generations.</span>

<span class="sd">    This method executes the optimization process and returns a dictionary containing the optimized</span>
<span class="sd">    parameters, corresponding objective values, and total execution time.</span>

<span class="sd">    The following JSON files are saved in `calsim_dir`:</span>

<span class="sd">    - `optimization_history.json`: A dictionary containing the optimization history. Each key in this</span>
<span class="sd">      file is an integer starting from 1, representing the generation number. The corresponding value</span>
<span class="sd">      is a sub-dictionary with two keys: `pop` for the population data (decision variables) and `obj`</span>
<span class="sd">      for the objective function values. This file is useful for analyzing optimization progress,</span>
<span class="sd">      convergence trends, performance indicators, and visualization.</span>

<span class="sd">    - `optimization_result.json`: A dictionary containing the final output dictionary.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary with the following keys:</span>

<span class="sd">            - `algorithm`: Name of the algorithm.</span>
<span class="sd">            - `generation`: Number of generation to run.</span>
<span class="sd">            - `population`: Number of individual in each generation.</span>
<span class="sd">            - `total_simulation`: Number of total simulation.</span>
<span class="sd">            - `time_sec`: Total execution time in seconds.</span>
<span class="sd">            - `variables`: Array of optimized decision variables.</span>
<span class="sd">            - `objectives`: Array of objective values corresponding to the optimized decision variables.</span>

<span class="sd">    Note:</span>
<span class="sd">        - For multi-objective optimization, the number of `variables` and `objectives` may exceed one,</span>
<span class="sd">          representing non-dominated solutions where a solution cannot be improved in one objective</span>
<span class="sd">          without worsening another.</span>

<span class="sd">        - The computation progress can be tracked through the following `console` messages.</span>
<span class="sd">          The simulation index ranges from 1 to the total number of simulations, which equals the product</span>
<span class="sd">          of the population size and the number of generations:</span>

<span class="sd">            - `Started generation: &lt;current_started_generation&gt;/&lt;total_generations&gt;`</span>
<span class="sd">            - `Started simulation: &lt;current_started_index&gt;/&lt;total_simulations&gt;`</span>
<span class="sd">            - `Completed simulation: &lt;current_compeleted_index&gt;/&lt;total_simulations&gt;`</span>
<span class="sd">            - `Completed generation: &lt;current_completed_generation&gt;/&lt;total_generations&gt;`</span>

<span class="sd">        - The disk space on the computer for `calsim_dir` must be sufficient to run</span>
<span class="sd">          parallel simulations (at least `pop_size` times the size of the `TxtInOut` folder).</span>
<span class="sd">          Otherwise, no error will be raised by the system, but simulation outputs may not be generated.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Algorithm object</span>
    <span class="n">alg_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_algorithm_class</span><span class="p">(</span>
        <span class="n">algorithm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span>
    <span class="p">)</span>
    <span class="n">alg_object</span> <span class="o">=</span> <span class="n">alg_class</span><span class="p">(</span>
        <span class="n">pop_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pop_size</span>
    <span class="p">)</span>

    <span class="c1"># Optimization result</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">pymoo</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span>
        <span class="n">problem</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">algorithm</span><span class="o">=</span><span class="n">alg_object</span><span class="p">,</span>
        <span class="n">termination</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;n_gen&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_gen</span><span class="p">),</span>
        <span class="n">save_history</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="c1"># Sign of objective directions</span>
    <span class="n">objs_dirs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_objectives_directions</span><span class="p">()</span>
    <span class="n">dir_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">objs_dirs</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;indicator&#39;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objective_config</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">]</span>
    <span class="n">dir_sign</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dir_list</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Save optimization history for each generation</span>
    <span class="n">opt_hist</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">gen</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">history</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">opt_hist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;pop&#39;</span><span class="p">:</span> <span class="n">gen</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="s1">&#39;obj&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">gen</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">dir_sign</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calsim_dir</span> <span class="o">/</span> <span class="s1">&#39;optimization_history.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_write</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">opt_hist</span><span class="p">,</span> <span class="n">output_write</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="c1"># Optimized output of parameters, objectives, and execution times</span>
    <span class="n">opt_output</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;algorithm&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="p">,</span>
        <span class="s1">&#39;generation&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_gen</span><span class="p">,</span>
        <span class="s1">&#39;population&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop_size</span><span class="p">,</span>
        <span class="s1">&#39;total_simulation&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop_size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_gen</span><span class="p">,</span>
        <span class="s1">&#39;time_sec&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">exec_time</span><span class="p">),</span>
        <span class="s1">&#39;variables&#39;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">X</span><span class="p">,</span>
        <span class="s1">&#39;objectives&#39;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">F</span> <span class="o">*</span> <span class="n">dir_sign</span>
    <span class="p">}</span>

    <span class="c1"># Save optimized outputs</span>
    <span class="n">save_output</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">opt_output</span><span class="p">)</span>
    <span class="n">save_output</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;var&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">))</span> <span class="k">else</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">save_output</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calsim_dir</span> <span class="o">/</span> <span class="s1">&#39;optimization_result.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_write</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">save_output</span><span class="p">,</span> <span class="n">output_write</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">opt_output</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>