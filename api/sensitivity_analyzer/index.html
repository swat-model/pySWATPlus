
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../data_manager/">
      
      
        <link rel="next" href="../performance_metrics/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>SensitivityAnalyzer - pySWATPlus</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.e53b48f4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pySWATPlus.SensitivityAnalyzer" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="pySWATPlus" class="md-header__button md-logo" aria-label="pySWATPlus" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            pySWATPlus
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              SensitivityAnalyzer
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../userguide/swatplus_simulation/" class="md-tabs__link">
          
  
  
  User Guide

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../txtinout_reader/" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../CONTRIBUTING/" class="md-tabs__link">
        
  
  
    
  
  Contributor Guide

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../changelog/" class="md-tabs__link">
        
  
  
    
  
  Release Notes

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="pySWATPlus" class="md-nav__button md-logo" aria-label="pySWATPlus" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    pySWATPlus
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/swatplus_simulation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SWAT+ Simulation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/sensitivity_analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sensitivity Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../userguide/read_output/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Read Output
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../txtinout_reader/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TxtinoutReader
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../filereader/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FileReader
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data_manager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DataManager
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    SensitivityAnalyzer
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    SensitivityAnalyzer
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pySWATPlus.SensitivityAnalyzer" class="md-nav__link">
    <span class="md-ellipsis">
      SensitivityAnalyzer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SensitivityAnalyzer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pySWATPlus.SensitivityAnalyzer.simulation_by_sobol_sample" class="md-nav__link">
    <span class="md-ellipsis">
      simulation_by_sobol_sample
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../performance_metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PerformanceMetrics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pySWATPlus.types
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CONTRIBUTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributor Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release Notes
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pySWATPlus.SensitivityAnalyzer" class="md-nav__link">
    <span class="md-ellipsis">
      SensitivityAnalyzer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SensitivityAnalyzer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pySWATPlus.SensitivityAnalyzer.simulation_by_sobol_sample" class="md-nav__link">
    <span class="md-ellipsis">
      simulation_by_sobol_sample
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>SensitivityAnalyzer</h1>

<div class="doc doc-object doc-class">



<h2 id="pySWATPlus.SensitivityAnalyzer" class="doc doc-heading">
            <code>SensitivityAnalyzer</code>


</h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pySWATPlus.base_sensitivity_analyser.BaseSensitivityAnalyzer">BaseSensitivityAnalyzer</span></code></p>


        <p>Provides functionality for running scenario simulations and analyzing simulated data.</p>


<details class="warning" open>
  <summary>Warning</summary>
  <p>This class is currently under development and not recommended for use.</p>
</details>







              <details class="quote">
                <summary>Source code in <code>pySWATPlus/cal_sensitivity_analyzer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SensitivityAnalyzer</span><span class="p">(</span><span class="n">BaseSensitivityAnalyzer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Provides functionality for running scenario simulations and analyzing simulated data.</span>

<span class="sd">    Warning:</span>
<span class="sd">        This class is currently under development and not recommended for use.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_simulation_in_cpu</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">track_sim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">var_array</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span>
        <span class="n">num_sim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">var_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">simulation_folder</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
        <span class="n">txtinout_folder</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ParameterBoundedModel</span><span class="p">],</span>
        <span class="n">simulation_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]],</span>
        <span class="n">clean_setup</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Private function that runs a SWAT+ simulation asynchronously on a dedicated logical CPU.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># variable dictionary</span>
        <span class="n">var_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">var_names</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="nb">float</span><span class="p">(</span><span class="n">var_array</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">var_names</span><span class="p">))</span>
        <span class="p">}</span>

        <span class="c1"># create &#39;params&#39; dictionary with assigned value</span>
        <span class="n">params_sim</span><span class="p">:</span> <span class="n">ParametersType</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span>
            <span class="n">change_type</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">change_type</span>
            <span class="n">units</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">units</span>
            <span class="n">unique_name</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">_make_unique_param_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">var_dict</span><span class="p">[</span><span class="n">unique_name</span><span class="p">]</span>
            <span class="n">conditions</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">conditions</span>
            <span class="n">params_sim</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
                <span class="s1">&#39;change_type&#39;</span><span class="p">:</span> <span class="n">change_type</span><span class="p">,</span>
                <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="n">units</span><span class="p">,</span>
                <span class="s1">&#39;conditions&#39;</span><span class="p">:</span> <span class="n">conditions</span>
            <span class="p">})</span>

        <span class="n">dir_path</span><span class="p">,</span> <span class="n">simulation_output</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_setup_simulation_directory</span><span class="p">(</span>
            <span class="n">track_sim</span><span class="o">=</span><span class="n">track_sim</span><span class="p">,</span>
            <span class="n">num_sim</span><span class="o">=</span><span class="n">num_sim</span><span class="p">,</span>
            <span class="n">var_array</span><span class="o">=</span><span class="n">var_array</span><span class="p">,</span>
            <span class="n">simulation_folder</span><span class="o">=</span><span class="n">simulation_folder</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Initialize TxtinoutReader class</span>
        <span class="n">txtinout_reader</span> <span class="o">=</span> <span class="n">TxtinoutReader</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="n">txtinout_folder</span>
        <span class="p">)</span>

        <span class="c1"># Run SWAT+ model in other directory</span>
        <span class="n">txtinout_reader</span><span class="o">.</span><span class="n">run_swat</span><span class="p">(</span>
            <span class="n">target_dir</span><span class="o">=</span><span class="n">dir_path</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">params_sim</span>
        <span class="p">)</span>

        <span class="c1"># Extract simulated data</span>
        <span class="n">simulation_output</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_extract_simulation_data</span><span class="p">(</span>
            <span class="n">dir_path</span><span class="o">=</span><span class="n">dir_path</span><span class="p">,</span>
            <span class="n">simulation_data</span><span class="o">=</span><span class="n">simulation_data</span><span class="p">,</span>
            <span class="n">simulation_output</span><span class="o">=</span><span class="n">simulation_output</span><span class="p">,</span>
            <span class="n">clean_setup</span><span class="o">=</span><span class="n">clean_setup</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">simulation_output</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">simulation_by_sobol_sample</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">:</span> <span class="n">ParametersBoundedType</span><span class="p">,</span>
        <span class="n">sample_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">simulation_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
        <span class="n">txtinout_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
        <span class="n">simulation_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]],</span>
        <span class="n">max_workers</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">save_output</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">clean_setup</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Provides a high-level interface for performing sensitivity simulations through parallel computing.</span>

<span class="sd">        It uses the method [`SALib.sample.sobol.sample`](https://salib.readthedocs.io/en/latest/api/SALib.sample.html#SALib.sample.sobol.sample),</span>
<span class="sd">        based on [`Sobol sequences`](https://doi.org/10.1016/S0378-4754(00)00270-6), to generate samples from the defined parameter space.</span>

<span class="sd">        For each sample, a dedicated directory is created, and a simulation is executed as a separate process using</span>
<span class="sd">        [`concurrent.futures.ProcessPoolExecutor`](https://docs.python.org/3/library/concurrent.futures.html#processpoolexecutor).</span>
<span class="sd">        Simulations are executed asynchronously, and to ensure computational efficiency, only unique samples are simulated.</span>

<span class="sd">        Each simulation directory is named `sim_&lt;i&gt;`, where `i` ranges from 1 to the number of unique simulations.</span>
<span class="sd">        Simulation results are collected by mapping input samples to their corresponding simulation directories.</span>
<span class="sd">        This mapping is then used to reorder the simulation outputs to match the original input samples.</span>

<span class="sd">        The method returns a detailed dictionary containing time statistics, the problem definition,</span>
<span class="sd">        the sample array, and the simulation results for further analysis.</span>

<span class="sd">        Args:</span>

<span class="sd">            parameters (ParametersBoundedType):  Nested dictionary defining the parameter modifications to apply during the simulations.</span>
<span class="sd">                Each parameter should include a the lower and upper bounds, and the parameter value</span>
<span class="sd">                is dynamically assigned with the corresponding sampled value during execution.</span>
<span class="sd">                ```python</span>
<span class="sd">                parameters = {</span>
<span class="sd">                    &quot;bf_max&quot;: [{</span>
<span class="sd">                        &quot;change_type&quot;: &quot;absval&quot;,</span>
<span class="sd">                        &quot;lower_bound&quot;: 0.2,</span>
<span class="sd">                        &quot;upper_bound&quot;: 0.3,</span>
<span class="sd">                        &quot;units&quot;: range(1, 194)</span>
<span class="sd">                    }]</span>
<span class="sd">                }</span>
<span class="sd">                ```</span>


<span class="sd">            sample_number (int): sample_number (int): Determines the number of samples.</span>
<span class="sd">                Generates an array of length `2^N * (D + 1)`, where `D` is the number of parameter changes</span>
<span class="sd">                and `N = sample_number + 1`. For example, when `sample_number` is 1, 12 samples will be generated.</span>

<span class="sd">            simulation_folder (str | pathlib.Path): Path to the folder where individual simulations for each parameter set will be performed.</span>
<span class="sd">                Raises an error if the folder is not empty. This precaution helps prevent data deletion, overwriting directories,</span>
<span class="sd">                and issues with reading required data files not generated by the simulation.</span>

<span class="sd">            txtinout_folder (str | pathlib.Path): Path to the `TxtInOut` folder. Raises an error if the folder does not contain exactly one SWAT+ executable `.exe` file.</span>

<span class="sd">            simulation_data (dict[str, dict[str, typing.Any]]):  Nested dictionary that specifies how to extract data</span>
<span class="sd">                from SWAT+ simulation-generated files. The keys are filenames (without paths) of the output files.</span>
<span class="sd">                Each key must map to a non-empty dictionary with the following subkeys:</span>

<span class="sd">                - `has_units (bool)`: Mandatory subkey. If `True`, the third line of the simulated file contains units for the columns.</span>
<span class="sd">                - `start_date (str)`: Optional subkey in `YYYY-MM-DD` format. Defaults to the earliest date in the simulated file.</span>
<span class="sd">                - `end_date (str)`: Optional subkey in `YYYY-MM-DD` format. Defaults to the latest date in the simulated file.</span>
<span class="sd">                - `apply_filter (dict[str, list[typing.Any]])`: Optional subkey. Each key is a column name and the corresponding value</span>
<span class="sd">                  is a list of allowed values for filtering rows in the DataFrame. By default, no filtering is applied.</span>
<span class="sd">                  An error is raised if filtering produces an empty DataFrame.</span>
<span class="sd">                - `usecols (list[str])`: Optional subkey. List of columns to extract from the simulated file. By default, all available columns are used.</span>

<span class="sd">                ```python</span>
<span class="sd">                simulation_data = {</span>
<span class="sd">                    &#39;channel_sd_mon.txt&#39;: {</span>
<span class="sd">                        &#39;has_units&#39;: True,</span>
<span class="sd">                        &#39;start_date&#39;: &#39;2014-06-01&#39;,</span>
<span class="sd">                        &#39;end_date&#39;: &#39;2016-10-01&#39;,</span>
<span class="sd">                        &#39;apply_filter&#39;: {&#39;gis_id&#39;: [561], &#39;yr&#39;: [2015, 2016]},</span>
<span class="sd">                        &#39;usecols&#39;: [&#39;gis_id&#39;, &#39;flo_out&#39;]</span>
<span class="sd">                    },</span>
<span class="sd">                    &#39;channel_sd_yr.txt&#39;: {</span>
<span class="sd">                        &#39;has_units&#39;: True,</span>
<span class="sd">                        &#39;apply_filter&#39;: {&#39;name&#39;: [&#39;cha561&#39;], &#39;yr&#39;: [2015, 2016]},</span>
<span class="sd">                        &#39;usecols&#39;: [&#39;gis_id&#39;, &#39;flo_out&#39;]</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">                ```</span>

<span class="sd">            max_workers (int): Number of logical CPUs to use for parallel processing.</span>
<span class="sd">                By default, all available logical CPUs are used.</span>

<span class="sd">            save_output (bool): If `True` (default), saves the output dictionary to `simulation_folder` as `sensitivity_simulation_sobol.json`.</span>

<span class="sd">            clean_setup (bool): If `True` (default), each folder created during the parallel simulation and its contents</span>
<span class="sd">                will be deleted dynamically after collecting the required data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary with the follwoing keys:</span>

<span class="sd">                - `time`: A dictionary A dictionary containing time-related statistics:</span>

<span class="sd">                    - `sample_length`: Total number of samples, including duplicates.</span>
<span class="sd">                    - `total_time_sec`: Total time in seconds for the simulation.</span>
<span class="sd">                    - `time_per_sample_sec`: Average simulation time per sample in seconds.</span>

<span class="sd">                - `problem`: The problem definition dictionary passed to `Sobol` sampling, containing:</span>

<span class="sd">                    - `num_vars`: Number of variables.</span>
<span class="sd">                    - `names`: Names of the variables.</span>
<span class="sd">                    - `bounds`: Lower and upper bounds for each variable.</span>

<span class="sd">                - `sample`: The sampled array of parameter sets used in the simulations.</span>

<span class="sd">                - `simulation`: Dictionary mapping simulation indices (integers from 1 to `sample_length`) to output sub-dictionaries with the following keys:</span>

<span class="sd">                    - `var`: Dictionary mapping each variable name (from `var_names`) to the actual value used in that simulation.</span>
<span class="sd">                    - `dir`: Name of the directory (e.g., `sim_&lt;i&gt;`) where the simulation was executed. This is useful when `clean_setup` is `False`, as it allows users</span>
<span class="sd">                      to verify whether the sampled values were correctly applied to the target files. The simulation index and directory name (e.g., `sim_&lt;i&gt;`)</span>
<span class="sd">                      may not always match one-to-one due to deduplication or asynchronous execution.</span>
<span class="sd">                    - `&lt;simulation_data_filename&gt;_df`: Filtered `DataFrame` generated for each file specified in the `simulation_data` dictionary</span>
<span class="sd">                      (e.g., `channel_sd_mon_df`, `channel_sd_yr_df`). Each DataFrame includes a `date` column with `datetime.date` objects.</span>


<span class="sd">        Note:</span>
<span class="sd">            - The `problem` dictionary and `sample` array are used later to calculate Sobol indices</span>
<span class="sd">              when comparing performance metrics against observed data.</span>

<span class="sd">            - The integer keys in the `simulation` dictionary may not correspond directly to the</span>
<span class="sd">              simulation directory indices (given by the `dir` key as `sim_&lt;i&gt;`) due to deduplication</span>
<span class="sd">              and asynchronous execution.</span>

<span class="sd">            - The computation progress can be tracked through the following `console` messages, where</span>
<span class="sd">              the simulation index ranges from 1 to the total number of unique simulations:</span>

<span class="sd">                - `Started simulation: &lt;started_index&gt;/&lt;unique_simulations&gt;`</span>
<span class="sd">                - `Completed simulation: &lt;completed_index&gt;/&lt;unique_simulations&gt;`</span>

<span class="sd">            - The disk space on the computer for `simulation_folder` must be sufficient to run</span>
<span class="sd">              parallel simulations (at least `max_workers` times the size of the `TxtInOut` folder).</span>
<span class="sd">              Otherwise, no error will be raised by the system, but simulation outputs may not be generated.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># start time</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="n">_txtinout_folder</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">_ensure_path</span><span class="p">(</span><span class="n">txtinout_folder</span><span class="p">)</span>
        <span class="n">_simulation_folder</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">_ensure_path</span><span class="p">(</span><span class="n">simulation_folder</span><span class="p">)</span>

        <span class="n">_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">ParameterBoundedModel</span><span class="p">(</span><span class="o">**</span><span class="n">param</span><span class="p">)</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">]</span>
        <span class="n">validators</span><span class="o">.</span><span class="n">_calibration_parameters</span><span class="p">(</span><span class="n">_txtinout_folder</span><span class="p">,</span> <span class="n">_params</span><span class="p">)</span>

        <span class="n">var_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">var_bounds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">_params</span><span class="p">:</span>
            <span class="n">unique_name</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">_make_unique_param_name</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
            <span class="n">var_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unique_name</span><span class="p">)</span>
            <span class="n">var_bounds</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">param</span><span class="o">.</span><span class="n">lower_bound</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">upper_bound</span><span class="p">])</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">_validate_simulation_by_sobol_sample_params</span><span class="p">(</span>
            <span class="n">simulation_folder</span><span class="o">=</span><span class="n">_simulation_folder</span><span class="p">,</span>
            <span class="n">simulation_data</span><span class="o">=</span><span class="n">simulation_data</span><span class="p">,</span>
            <span class="n">var_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">,</span>
            <span class="n">var_bounds</span><span class="o">=</span><span class="n">var_bounds</span>
        <span class="p">)</span>

        <span class="n">problem</span><span class="p">,</span> <span class="n">sample_array</span><span class="p">,</span> <span class="n">unique_array</span><span class="p">,</span> <span class="n">num_sim</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_prepare_sobol_samples</span><span class="p">(</span>
            <span class="n">var_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">,</span>
            <span class="n">var_bounds</span><span class="o">=</span><span class="n">var_bounds</span><span class="p">,</span>
            <span class="n">sample_number</span><span class="o">=</span><span class="n">sample_number</span>
        <span class="p">)</span>

        <span class="c1"># Function for individual CPU simulation</span>
        <span class="n">cpu_sim</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_simulation_in_cpu</span><span class="p">,</span>
            <span class="n">num_sim</span><span class="o">=</span><span class="n">num_sim</span><span class="p">,</span>
            <span class="n">var_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">,</span>
            <span class="n">simulation_folder</span><span class="o">=</span><span class="n">_simulation_folder</span><span class="p">,</span>
            <span class="n">txtinout_folder</span><span class="o">=</span><span class="n">_txtinout_folder</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">_params</span><span class="p">,</span>
            <span class="n">simulation_data</span><span class="o">=</span><span class="n">simulation_data</span><span class="p">,</span>
            <span class="n">clean_setup</span><span class="o">=</span><span class="n">clean_setup</span>
        <span class="p">)</span>

        <span class="c1"># Assigning model simulation in individual computer CPU and collect results</span>
        <span class="n">cpu_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ProcessPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="c1"># Multicore simulation</span>
            <span class="n">futures</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">cpu_sim</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_array</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">future</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">),</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
                <span class="c1"># Message for completion of individual simulation for better tracking</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Completed simulation: </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">num_sim</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1"># collect simulation results</span>
                <span class="n">idx_r</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
                <span class="n">cpu_dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">idx_r</span><span class="p">[</span><span class="s1">&#39;array&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">idx_r</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;array&#39;</span>
                <span class="p">}</span>

        <span class="c1"># Generate sensitivity simulation output for all sample_array from unique_array outputs</span>
        <span class="n">output_dict</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_collect_sobol_results</span><span class="p">(</span>
            <span class="n">sample_array</span><span class="o">=</span><span class="n">sample_array</span><span class="p">,</span>
            <span class="n">var_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">,</span>
            <span class="n">cpu_dict</span><span class="o">=</span><span class="n">cpu_dict</span><span class="p">,</span>
            <span class="n">problem_dict</span><span class="o">=</span><span class="n">problem</span><span class="p">,</span>
            <span class="n">start_time</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span>
            <span class="n">simulation_folder</span><span class="o">=</span><span class="n">_simulation_folder</span><span class="p">,</span>
            <span class="n">save_output</span><span class="o">=</span><span class="n">save_output</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">output_dict</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="pySWATPlus.SensitivityAnalyzer.simulation_by_sobol_sample" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">simulation_by_sobol_sample</span><span class="p">(</span><span class="n">parameters</span><span class="p">:</span> <span class="n">ParametersBoundedType</span><span class="p">,</span> <span class="n">sample_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">simulation_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="n">txtinout_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="n">simulation_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]],</span> <span class="n">max_workers</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">save_output</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">clean_setup</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Provides a high-level interface for performing sensitivity simulations through parallel computing.</p>
<p>It uses the method <a href="https://salib.readthedocs.io/en/latest/api/SALib.sample.html#SALib.sample.sobol.sample"><code>SALib.sample.sobol.sample</code></a>,
based on <a href="https://doi.org/10.1016/S0378-4754(00)00270-6"><code>Sobol sequences</code></a>, to generate samples from the defined parameter space.</p>
<p>For each sample, a dedicated directory is created, and a simulation is executed as a separate process using
<a href="https://docs.python.org/3/library/concurrent.futures.html#processpoolexecutor"><code>concurrent.futures.ProcessPoolExecutor</code></a>.
Simulations are executed asynchronously, and to ensure computational efficiency, only unique samples are simulated.</p>
<p>Each simulation directory is named <code>sim_&lt;i&gt;</code>, where <code>i</code> ranges from 1 to the number of unique simulations.
Simulation results are collected by mapping input samples to their corresponding simulation directories.
This mapping is then used to reorder the simulation outputs to match the original input samples.</p>
<p>The method returns a detailed dictionary containing time statistics, the problem definition,
the sample array, and the simulation results for further analysis.</p>
<p>Args:</p>
<div class="highlight"><pre><span></span><code>parameters (ParametersBoundedType):  Nested dictionary defining the parameter modifications to apply during the simulations.
    Each parameter should include a the lower and upper bounds, and the parameter value
    is dynamically assigned with the corresponding sampled value during execution.
    ```python
    parameters = {
        &quot;bf_max&quot;: [{
            &quot;change_type&quot;: &quot;absval&quot;,
            &quot;lower_bound&quot;: 0.2,
            &quot;upper_bound&quot;: 0.3,
            &quot;units&quot;: range(1, 194)
        }]
    }
    ```


sample_number (int): sample_number (int): Determines the number of samples.
    Generates an array of length `2^N * (D + 1)`, where `D` is the number of parameter changes
    and `N = sample_number + 1`. For example, when `sample_number` is 1, 12 samples will be generated.

simulation_folder (str | pathlib.Path): Path to the folder where individual simulations for each parameter set will be performed.
    Raises an error if the folder is not empty. This precaution helps prevent data deletion, overwriting directories,
    and issues with reading required data files not generated by the simulation.

txtinout_folder (str | pathlib.Path): Path to the `TxtInOut` folder. Raises an error if the folder does not contain exactly one SWAT+ executable `.exe` file.

simulation_data (dict[str, dict[str, typing.Any]]):  Nested dictionary that specifies how to extract data
    from SWAT+ simulation-generated files. The keys are filenames (without paths) of the output files.
    Each key must map to a non-empty dictionary with the following subkeys:

    - `has_units (bool)`: Mandatory subkey. If `True`, the third line of the simulated file contains units for the columns.
    - `start_date (str)`: Optional subkey in `YYYY-MM-DD` format. Defaults to the earliest date in the simulated file.
    - `end_date (str)`: Optional subkey in `YYYY-MM-DD` format. Defaults to the latest date in the simulated file.
    - `apply_filter (dict[str, list[typing.Any]])`: Optional subkey. Each key is a column name and the corresponding value
      is a list of allowed values for filtering rows in the DataFrame. By default, no filtering is applied.
      An error is raised if filtering produces an empty DataFrame.
    - `usecols (list[str])`: Optional subkey. List of columns to extract from the simulated file. By default, all available columns are used.

    ```python
    simulation_data = {
        &#39;channel_sd_mon.txt&#39;: {
            &#39;has_units&#39;: True,
            &#39;start_date&#39;: &#39;2014-06-01&#39;,
            &#39;end_date&#39;: &#39;2016-10-01&#39;,
            &#39;apply_filter&#39;: {&#39;gis_id&#39;: [561], &#39;yr&#39;: [2015, 2016]},
            &#39;usecols&#39;: [&#39;gis_id&#39;, &#39;flo_out&#39;]
        },
        &#39;channel_sd_yr.txt&#39;: {
            &#39;has_units&#39;: True,
            &#39;apply_filter&#39;: {&#39;name&#39;: [&#39;cha561&#39;], &#39;yr&#39;: [2015, 2016]},
            &#39;usecols&#39;: [&#39;gis_id&#39;, &#39;flo_out&#39;]
        }
    }
    ```

max_workers (int): Number of logical CPUs to use for parallel processing.
    By default, all available logical CPUs are used.

save_output (bool): If `True` (default), saves the output dictionary to `simulation_folder` as `sensitivity_simulation_sobol.json`.

clean_setup (bool): If `True` (default), each folder created during the parallel simulation and its contents
    will be deleted dynamically after collecting the required data.
</code></pre></div>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary with the follwoing keys:</p>
<ul>
<li>
<p><code>time</code>: A dictionary A dictionary containing time-related statistics:</p>
<ul>
<li><code>sample_length</code>: Total number of samples, including duplicates.</li>
<li><code>total_time_sec</code>: Total time in seconds for the simulation.</li>
<li><code>time_per_sample_sec</code>: Average simulation time per sample in seconds.</li>
</ul>
</li>
<li>
<p><code>problem</code>: The problem definition dictionary passed to <code>Sobol</code> sampling, containing:</p>
<ul>
<li><code>num_vars</code>: Number of variables.</li>
<li><code>names</code>: Names of the variables.</li>
<li><code>bounds</code>: Lower and upper bounds for each variable.</li>
</ul>
</li>
<li>
<p><code>sample</code>: The sampled array of parameter sets used in the simulations.</p>
</li>
<li>
<p><code>simulation</code>: Dictionary mapping simulation indices (integers from 1 to <code>sample_length</code>) to output sub-dictionaries with the following keys:</p>
<ul>
<li><code>var</code>: Dictionary mapping each variable name (from <code>var_names</code>) to the actual value used in that simulation.</li>
<li><code>dir</code>: Name of the directory (e.g., <code>sim_&lt;i&gt;</code>) where the simulation was executed. This is useful when <code>clean_setup</code> is <code>False</code>, as it allows users
  to verify whether the sampled values were correctly applied to the target files. The simulation index and directory name (e.g., <code>sim_&lt;i&gt;</code>)
  may not always match one-to-one due to deduplication or asynchronous execution.</li>
<li><code>&lt;simulation_data_filename&gt;_df</code>: Filtered <code>DataFrame</code> generated for each file specified in the <code>simulation_data</code> dictionary
  (e.g., <code>channel_sd_mon_df</code>, <code>channel_sd_yr_df</code>). Each DataFrame includes a <code>date</code> column with <code>datetime.date</code> objects.</li>
</ul>
</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <ul>
<li>
<p>The <code>problem</code> dictionary and <code>sample</code> array are used later to calculate Sobol indices
  when comparing performance metrics against observed data.</p>
</li>
<li>
<p>The integer keys in the <code>simulation</code> dictionary may not correspond directly to the
  simulation directory indices (given by the <code>dir</code> key as <code>sim_&lt;i&gt;</code>) due to deduplication
  and asynchronous execution.</p>
</li>
<li>
<p>The computation progress can be tracked through the following <code>console</code> messages, where
  the simulation index ranges from 1 to the total number of unique simulations:</p>
<ul>
<li><code>Started simulation: &lt;started_index&gt;/&lt;unique_simulations&gt;</code></li>
<li><code>Completed simulation: &lt;completed_index&gt;/&lt;unique_simulations&gt;</code></li>
</ul>
</li>
<li>
<p>The disk space on the computer for <code>simulation_folder</code> must be sufficient to run
  parallel simulations (at least <code>max_workers</code> times the size of the <code>TxtInOut</code> folder).
  Otherwise, no error will be raised by the system, but simulation outputs may not be generated.</p>
</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>pySWATPlus/cal_sensitivity_analyzer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">simulation_by_sobol_sample</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">parameters</span><span class="p">:</span> <span class="n">ParametersBoundedType</span><span class="p">,</span>
    <span class="n">sample_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">simulation_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
    <span class="n">txtinout_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
    <span class="n">simulation_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]],</span>
    <span class="n">max_workers</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save_output</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">clean_setup</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Provides a high-level interface for performing sensitivity simulations through parallel computing.</span>

<span class="sd">    It uses the method [`SALib.sample.sobol.sample`](https://salib.readthedocs.io/en/latest/api/SALib.sample.html#SALib.sample.sobol.sample),</span>
<span class="sd">    based on [`Sobol sequences`](https://doi.org/10.1016/S0378-4754(00)00270-6), to generate samples from the defined parameter space.</span>

<span class="sd">    For each sample, a dedicated directory is created, and a simulation is executed as a separate process using</span>
<span class="sd">    [`concurrent.futures.ProcessPoolExecutor`](https://docs.python.org/3/library/concurrent.futures.html#processpoolexecutor).</span>
<span class="sd">    Simulations are executed asynchronously, and to ensure computational efficiency, only unique samples are simulated.</span>

<span class="sd">    Each simulation directory is named `sim_&lt;i&gt;`, where `i` ranges from 1 to the number of unique simulations.</span>
<span class="sd">    Simulation results are collected by mapping input samples to their corresponding simulation directories.</span>
<span class="sd">    This mapping is then used to reorder the simulation outputs to match the original input samples.</span>

<span class="sd">    The method returns a detailed dictionary containing time statistics, the problem definition,</span>
<span class="sd">    the sample array, and the simulation results for further analysis.</span>

<span class="sd">    Args:</span>

<span class="sd">        parameters (ParametersBoundedType):  Nested dictionary defining the parameter modifications to apply during the simulations.</span>
<span class="sd">            Each parameter should include a the lower and upper bounds, and the parameter value</span>
<span class="sd">            is dynamically assigned with the corresponding sampled value during execution.</span>
<span class="sd">            ```python</span>
<span class="sd">            parameters = {</span>
<span class="sd">                &quot;bf_max&quot;: [{</span>
<span class="sd">                    &quot;change_type&quot;: &quot;absval&quot;,</span>
<span class="sd">                    &quot;lower_bound&quot;: 0.2,</span>
<span class="sd">                    &quot;upper_bound&quot;: 0.3,</span>
<span class="sd">                    &quot;units&quot;: range(1, 194)</span>
<span class="sd">                }]</span>
<span class="sd">            }</span>
<span class="sd">            ```</span>


<span class="sd">        sample_number (int): sample_number (int): Determines the number of samples.</span>
<span class="sd">            Generates an array of length `2^N * (D + 1)`, where `D` is the number of parameter changes</span>
<span class="sd">            and `N = sample_number + 1`. For example, when `sample_number` is 1, 12 samples will be generated.</span>

<span class="sd">        simulation_folder (str | pathlib.Path): Path to the folder where individual simulations for each parameter set will be performed.</span>
<span class="sd">            Raises an error if the folder is not empty. This precaution helps prevent data deletion, overwriting directories,</span>
<span class="sd">            and issues with reading required data files not generated by the simulation.</span>

<span class="sd">        txtinout_folder (str | pathlib.Path): Path to the `TxtInOut` folder. Raises an error if the folder does not contain exactly one SWAT+ executable `.exe` file.</span>

<span class="sd">        simulation_data (dict[str, dict[str, typing.Any]]):  Nested dictionary that specifies how to extract data</span>
<span class="sd">            from SWAT+ simulation-generated files. The keys are filenames (without paths) of the output files.</span>
<span class="sd">            Each key must map to a non-empty dictionary with the following subkeys:</span>

<span class="sd">            - `has_units (bool)`: Mandatory subkey. If `True`, the third line of the simulated file contains units for the columns.</span>
<span class="sd">            - `start_date (str)`: Optional subkey in `YYYY-MM-DD` format. Defaults to the earliest date in the simulated file.</span>
<span class="sd">            - `end_date (str)`: Optional subkey in `YYYY-MM-DD` format. Defaults to the latest date in the simulated file.</span>
<span class="sd">            - `apply_filter (dict[str, list[typing.Any]])`: Optional subkey. Each key is a column name and the corresponding value</span>
<span class="sd">              is a list of allowed values for filtering rows in the DataFrame. By default, no filtering is applied.</span>
<span class="sd">              An error is raised if filtering produces an empty DataFrame.</span>
<span class="sd">            - `usecols (list[str])`: Optional subkey. List of columns to extract from the simulated file. By default, all available columns are used.</span>

<span class="sd">            ```python</span>
<span class="sd">            simulation_data = {</span>
<span class="sd">                &#39;channel_sd_mon.txt&#39;: {</span>
<span class="sd">                    &#39;has_units&#39;: True,</span>
<span class="sd">                    &#39;start_date&#39;: &#39;2014-06-01&#39;,</span>
<span class="sd">                    &#39;end_date&#39;: &#39;2016-10-01&#39;,</span>
<span class="sd">                    &#39;apply_filter&#39;: {&#39;gis_id&#39;: [561], &#39;yr&#39;: [2015, 2016]},</span>
<span class="sd">                    &#39;usecols&#39;: [&#39;gis_id&#39;, &#39;flo_out&#39;]</span>
<span class="sd">                },</span>
<span class="sd">                &#39;channel_sd_yr.txt&#39;: {</span>
<span class="sd">                    &#39;has_units&#39;: True,</span>
<span class="sd">                    &#39;apply_filter&#39;: {&#39;name&#39;: [&#39;cha561&#39;], &#39;yr&#39;: [2015, 2016]},</span>
<span class="sd">                    &#39;usecols&#39;: [&#39;gis_id&#39;, &#39;flo_out&#39;]</span>
<span class="sd">                }</span>
<span class="sd">            }</span>
<span class="sd">            ```</span>

<span class="sd">        max_workers (int): Number of logical CPUs to use for parallel processing.</span>
<span class="sd">            By default, all available logical CPUs are used.</span>

<span class="sd">        save_output (bool): If `True` (default), saves the output dictionary to `simulation_folder` as `sensitivity_simulation_sobol.json`.</span>

<span class="sd">        clean_setup (bool): If `True` (default), each folder created during the parallel simulation and its contents</span>
<span class="sd">            will be deleted dynamically after collecting the required data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dictionary with the follwoing keys:</span>

<span class="sd">            - `time`: A dictionary A dictionary containing time-related statistics:</span>

<span class="sd">                - `sample_length`: Total number of samples, including duplicates.</span>
<span class="sd">                - `total_time_sec`: Total time in seconds for the simulation.</span>
<span class="sd">                - `time_per_sample_sec`: Average simulation time per sample in seconds.</span>

<span class="sd">            - `problem`: The problem definition dictionary passed to `Sobol` sampling, containing:</span>

<span class="sd">                - `num_vars`: Number of variables.</span>
<span class="sd">                - `names`: Names of the variables.</span>
<span class="sd">                - `bounds`: Lower and upper bounds for each variable.</span>

<span class="sd">            - `sample`: The sampled array of parameter sets used in the simulations.</span>

<span class="sd">            - `simulation`: Dictionary mapping simulation indices (integers from 1 to `sample_length`) to output sub-dictionaries with the following keys:</span>

<span class="sd">                - `var`: Dictionary mapping each variable name (from `var_names`) to the actual value used in that simulation.</span>
<span class="sd">                - `dir`: Name of the directory (e.g., `sim_&lt;i&gt;`) where the simulation was executed. This is useful when `clean_setup` is `False`, as it allows users</span>
<span class="sd">                  to verify whether the sampled values were correctly applied to the target files. The simulation index and directory name (e.g., `sim_&lt;i&gt;`)</span>
<span class="sd">                  may not always match one-to-one due to deduplication or asynchronous execution.</span>
<span class="sd">                - `&lt;simulation_data_filename&gt;_df`: Filtered `DataFrame` generated for each file specified in the `simulation_data` dictionary</span>
<span class="sd">                  (e.g., `channel_sd_mon_df`, `channel_sd_yr_df`). Each DataFrame includes a `date` column with `datetime.date` objects.</span>


<span class="sd">    Note:</span>
<span class="sd">        - The `problem` dictionary and `sample` array are used later to calculate Sobol indices</span>
<span class="sd">          when comparing performance metrics against observed data.</span>

<span class="sd">        - The integer keys in the `simulation` dictionary may not correspond directly to the</span>
<span class="sd">          simulation directory indices (given by the `dir` key as `sim_&lt;i&gt;`) due to deduplication</span>
<span class="sd">          and asynchronous execution.</span>

<span class="sd">        - The computation progress can be tracked through the following `console` messages, where</span>
<span class="sd">          the simulation index ranges from 1 to the total number of unique simulations:</span>

<span class="sd">            - `Started simulation: &lt;started_index&gt;/&lt;unique_simulations&gt;`</span>
<span class="sd">            - `Completed simulation: &lt;completed_index&gt;/&lt;unique_simulations&gt;`</span>

<span class="sd">        - The disk space on the computer for `simulation_folder` must be sufficient to run</span>
<span class="sd">          parallel simulations (at least `max_workers` times the size of the `TxtInOut` folder).</span>
<span class="sd">          Otherwise, no error will be raised by the system, but simulation outputs may not be generated.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># start time</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">_txtinout_folder</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">_ensure_path</span><span class="p">(</span><span class="n">txtinout_folder</span><span class="p">)</span>
    <span class="n">_simulation_folder</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">_ensure_path</span><span class="p">(</span><span class="n">simulation_folder</span><span class="p">)</span>

    <span class="n">_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">ParameterBoundedModel</span><span class="p">(</span><span class="o">**</span><span class="n">param</span><span class="p">)</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">]</span>
    <span class="n">validators</span><span class="o">.</span><span class="n">_calibration_parameters</span><span class="p">(</span><span class="n">_txtinout_folder</span><span class="p">,</span> <span class="n">_params</span><span class="p">)</span>

    <span class="n">var_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">var_bounds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">_params</span><span class="p">:</span>
        <span class="n">unique_name</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">_make_unique_param_name</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
        <span class="n">var_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unique_name</span><span class="p">)</span>
        <span class="n">var_bounds</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">param</span><span class="o">.</span><span class="n">lower_bound</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">upper_bound</span><span class="p">])</span>

    <span class="bp">cls</span><span class="o">.</span><span class="n">_validate_simulation_by_sobol_sample_params</span><span class="p">(</span>
        <span class="n">simulation_folder</span><span class="o">=</span><span class="n">_simulation_folder</span><span class="p">,</span>
        <span class="n">simulation_data</span><span class="o">=</span><span class="n">simulation_data</span><span class="p">,</span>
        <span class="n">var_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">,</span>
        <span class="n">var_bounds</span><span class="o">=</span><span class="n">var_bounds</span>
    <span class="p">)</span>

    <span class="n">problem</span><span class="p">,</span> <span class="n">sample_array</span><span class="p">,</span> <span class="n">unique_array</span><span class="p">,</span> <span class="n">num_sim</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_prepare_sobol_samples</span><span class="p">(</span>
        <span class="n">var_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">,</span>
        <span class="n">var_bounds</span><span class="o">=</span><span class="n">var_bounds</span><span class="p">,</span>
        <span class="n">sample_number</span><span class="o">=</span><span class="n">sample_number</span>
    <span class="p">)</span>

    <span class="c1"># Function for individual CPU simulation</span>
    <span class="n">cpu_sim</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_simulation_in_cpu</span><span class="p">,</span>
        <span class="n">num_sim</span><span class="o">=</span><span class="n">num_sim</span><span class="p">,</span>
        <span class="n">var_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">,</span>
        <span class="n">simulation_folder</span><span class="o">=</span><span class="n">_simulation_folder</span><span class="p">,</span>
        <span class="n">txtinout_folder</span><span class="o">=</span><span class="n">_txtinout_folder</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="n">_params</span><span class="p">,</span>
        <span class="n">simulation_data</span><span class="o">=</span><span class="n">simulation_data</span><span class="p">,</span>
        <span class="n">clean_setup</span><span class="o">=</span><span class="n">clean_setup</span>
    <span class="p">)</span>

    <span class="c1"># Assigning model simulation in individual computer CPU and collect results</span>
    <span class="n">cpu_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ProcessPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
        <span class="c1"># Multicore simulation</span>
        <span class="n">futures</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">cpu_sim</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_array</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">future</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">),</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
            <span class="c1"># Message for completion of individual simulation for better tracking</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Completed simulation: </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">num_sim</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># collect simulation results</span>
            <span class="n">idx_r</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
            <span class="n">cpu_dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">idx_r</span><span class="p">[</span><span class="s1">&#39;array&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">idx_r</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;array&#39;</span>
            <span class="p">}</span>

    <span class="c1"># Generate sensitivity simulation output for all sample_array from unique_array outputs</span>
    <span class="n">output_dict</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_collect_sobol_results</span><span class="p">(</span>
        <span class="n">sample_array</span><span class="o">=</span><span class="n">sample_array</span><span class="p">,</span>
        <span class="n">var_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">,</span>
        <span class="n">cpu_dict</span><span class="o">=</span><span class="n">cpu_dict</span><span class="p">,</span>
        <span class="n">problem_dict</span><span class="o">=</span><span class="n">problem</span><span class="p">,</span>
        <span class="n">start_time</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span>
        <span class="n">simulation_folder</span><span class="o">=</span><span class="n">_simulation_folder</span><span class="p">,</span>
        <span class="n">save_output</span><span class="o">=</span><span class="n">save_output</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">output_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>